<!DOCTYPE html>
<html lang="en">
	<head>
		<style>
            body{
				background: #f2f2f2;
				font-family: Consolas, monaco, monospace;
			}

            h1{
				text-align: center;
				color: black;
				font-size: 45px;
				margin-bottom: 15px;
			}

			h2{
				text-align: left;
				margin-bottom: 15px;
			}

            div.form {
				text-align: center;
				font-size: 20px;
			}
            
            form [type = text] {
				width: 15%;
				border: 2px solid black;
				border-radius:4px;
				padding: 5px 5px;
				margin: 5px;
				box-sizing: border-box;
				font-family: inherit;
            }

            button{
				background-color: lightblue;
				border: none;
				color: black;
				border-radius: 4px;
				padding: 8px 16px;
				text-decoration: none;
				margin: 4px 2px;
				cursor: pointer;
				transition-duration:0.2s;
				font-family: inherit;
                font-weight: bold;
			}

			button:hover {
                background-color: black;
				color: lightblue;
            }

			table, th, td{
				width: 30%;
				border: 1.5px solid black;
				border-collapse: collapse;
				margin-bottom: 15px;
			}
			th{
				background-color: lightblue;
			}
        </style>
		<title>Welcome</title>
	</head>
	<body>
		<h1>Welcome</h1>
		<div class="form">
			<br>Add an item<br>
			<form action="/additem" method="POST">			
				<label for="inputTitle">Title</label>
				<input type="text" name="intitle">
				<br>
				
				<label for="inputDesc">Description: </label>
				<input type="text" name="indescription">
				<br>
				
				<label for="inputCategory">Category: </label>
				<input type="text" name="incategory">
				<br>
				
				<label for="inputPrice">Price: </label>
				<input type="text" name="inprice">
				<button type="submit">Add Item</button>
			</form>
		</div>	
		
		<hr>
		<div class="form">
			<br>Query 1</br>
			<form>
				<table>
					<tr>
						<td>Category</td>
						<td>Price</td>
					</tr>
					<tbody id="maxresult">
					</tbody>					
				</table>	
				<button id="maxbutton">MaxBtn</button>
			</form>
		</div>
				
		<hr>
		<div class="form">
			<br>Query 3</br>
			<form id="excelform" action="/excellentitems" method="POST">
				<label for = "exceluser">Enter a username: </label>
				<input type="text" id="excelinput" name="exceluser" placeholder="Enter Username">
				<button type="submit">Find Excellent</button>
			</form>
			
			<table id="exceltable">
				<tr>
					<td>Username</td>
					<td>Title</td>
				</tr>
				<tbody id="excelresult">
				
				</tbody>					
			</table>	
				
			</form>
		</div>
		
		<hr>
		<div class="form">
			<br>Query 7</br>
			<form>
				<table>
					<tr>
						<td>Username</td>
					</tr>
					<tbody id="nopoorresult">
					</tbody>
				</table>
				<button id="nopoorbutton">NoPoorBtn</button>
			</form>
		</div>
		
		<hr>
		<div class="form">
			<br>Query 8</br>
			<form>
				<table>
					<tr>
						<td>Username</td>
					</tr>
					<tbody id="allpoorresult">
					</tbody>
				</table>
				<button id="allpoorbutton">AllPoorBtn</button>
			</form>
		</div>

		<hr>riley<hr>
		<div class="form">	
			<form id="search-form" action="/searchcategory" method="POST">
				<label for="category">Enter a category: </label>
				<input type="text" id="input" name="category" placeholder="Category">
				<button type="submit">Search</button>
			</form>
		<h2>Results:</h2>
		<table id="results-table">
			<thead>
				<tr>
					<th>Items</th>
					<th>Category</th>
				</tr>
			</thead>
			<tbody id="results-body">

			</tbody>
		</table>
		</div>
		<div class="form">
			<br>Search Users by Categories<br>
			<form id="search-categories-form" action="/searchUsersByCategories" method="POST">
				<label for="category1">Category 1:</label>
				<input type="text" id="category1" name="category1" placeholder="Category 1">
				<br>
		
				<label for="category2">Category 2:</label>
				<input type="text" id="category2" name="category2" placeholder="Category 2">
				<br>
		
				<button type="submit" id="searchCategories">Search Users</button>
			</form>
			<h2>Users who posted at least two items in a day:</h2>
			<table id="users-table">
				<thead>
					<tr>
						<th>Username</th>
					</tr>
				</thead>
				<tbody id="users-result">
				</tbody>
			</table>
		</div>

		<hr>java<hr>
		<div id="add-review">
			<h2>Add a Review:</h2>
			<form id="review-form">
				<label for="itemSelect">Select an item:</label>
				<select id="itemSelect" name="item_id">
					
					<option value="1">Test Item 1</option> <!-- Replace "1" with the actual item ID -->
					<option value="2">Test Item 2</option> <!-- Replace "2" with the actual item ID -->
					<!-- Add more items with their respective IDs -->
				</select>
				<br>
				<label for="ratingSelect">Select a rating:</label>
				<select id="ratingSelect" name="rating">
					<option value="excellent">Excellent</option>
					<option value="good">Good</option>
					<option value="fair">Fair</option>
					<option value="poor">Poor</option>
				</select>
				<br>
				<label for="reviewText">Review:</label>
				<textarea id="reviewText" name="reviewText" rows="4" cols="50"></textarea>
				<br>
				<button type="button" id="submitReview">Submit Review</button>
			</form>
		</div>
		<hr>
		<h2>Create table button</h2>
			<form action="/createtable" method="post">
				<button type="submit" class="mybutton">Create table</button>
			</form>
		<hr>
		<a href="\">Logout</a>

		<!--Script to handle review calls when submit button is pressed-->
		<script>
			document.getElementById('submitReview').addEventListener('click', function () {
			const item_id = document.getElementById('itemSelect').value;
		    const rating = document.getElementById('ratingSelect').value;
		    const reviewText = document.getElementById('reviewText').value;
		
		    const data = { item_id, rating, reviewText };
		
		    fetch('/submitreview', {
				method: 'POST',
				headers: {
		        'Content-Type': 'application/json',
		      },
		      body: JSON.stringify(data),
		    })
		    .then(response => {
		      if (response.ok) {
		        console.log('Review submitted successfully');
		        alert('Review submitted successfully');
		        document.getElementById('reviewText').value = ''; // Clear the review text area
		      } else if (response.status === 403) {
		        console.log('You have already submitted three reviews today.');
		        alert('You have already submitted three reviews today.');
		      } else {
		        response.text().then(errorMessage => {
		          console.log('Error:', errorMessage);
		          alert('error: ' + errorMessage);
		        });
		      }
		    })
		    .catch(error => {
		      console.error('Error:', error);
		      alert('An error occurred. Please try again.');
		    });
		  });
		

			/*code for Query 1*/
			const baseUrl = 'http://localhost:3000/maxcat';
			const maxBtn = document.getElementById('maxbutton');
			//const input = document.getElementById('input');
			const maxresult = document.getElementById('maxresult');

			maxBtn.addEventListener('click', getMax);

			async function getMax(e) {
				e.preventDefault()
				const res = await fetch(baseUrl, 
				{
					method: 'GET'

				})
				const data0 = await res.json()
				maxresult.innerHTML = "";
				//input.innerHTML = data[1].max
				
				data0.forEach(e =>{
					const row0 = document.createElement("tr");
					row0.innerHTML = `<td>${e.category}</td><td>${e.max}</td>`
					maxresult.appendChild(row0);	
				})
			}
				
			/*Code for query 2*/
			const searchCategoriesForm = document.getElementById("search-categories-form");
			const usersTable = document.getElementById("users-table");
			const usersResultBody = document.getElementById("users-result");
		
			searchCategoriesForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				const category1 = document.getElementById("category1").value;
				const category2 = document.getElementById("category2").value;
		
				const response = await fetch("/searchUsersByCategories", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({ category1, category2 }),
				});
		
				if (response.ok) {
					const data = await response.json();
		
					usersResultBody.innerHTML = ""; // Clear previous results
		
					data.users.forEach(username => {
						const row = document.createElement("tr");
						row.innerHTML = `<td>${username}</td>`;
						usersResultBody.appendChild(row);
					});
				} else {
					console.error("Error in searchUsersByCategories:", response.statusText);
					usersResultBody.innerHTML = "<p>An error occurred while searching for users.</p>";
				}
			});
				
			/*code for Query 3*/
			const excelForm = document.getElementById("excelform");
			const excelTable = document.getElementById("exceltable");
			const excelResult = document.getElementById("excelresult");
			
			
			excelForm.addEventListener("submit", getExcel);
			
			async function getExcel(e) {
				e.preventDefault();
				const user = document.getElementById("excelinput").value;
				
				const ress = await fetch("/excellentitems", {
					method: "POST",
					headers: { "Content-Type" : "application/json"},
					body: JSON.stringify({user})
					});
				console.log(user);
				const response = await fetch("/excellentitems", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({ user }),
				});
				const test = await response.json();
				excelResult.innerHTML = "";
				console.log(test);
				
				test.forEach(e =>{
					const row3 = document.createElement("tr");
					row3.innerHTML = `<td>${e.username}</td><td>${e.title}</td>`
					excelResult.appendChild(row3);	
				})
			}
			/*code for Query 7*/
			const baseUrl7 = 'http://localhost:3000/nopoor';
			const poorBtn = document.getElementById('nopoorbutton');
			const nopoorResult = document.getElementById('nopoorresult');
			
			poorBtn.addEventListener('click', excPoor);
			
			async function excPoor(e){
				e.preventDefault();
				const res = await fetch(baseUrl7, 
				{
					method: 'GET'
				})
				const data7 = await res.json()
				console.log(data7);
				nopoorResult.innerHTML = "";
				
				data7.forEach(e =>{
					const row7 = document.createElement("tr");
					row7.innerHTML = `<td>${e.username}</td>`
					nopoorResult.appendChild(row7)
					})
			}
			
			const baseUrl8 = 'http://localhost:3000/allpoor';
			const allpoorBtn = document.getElementById('allpoorbutton');
			const allpoorResult = document.getElementById('allpoorresult');
			
			allpoorBtn.addEventListener('click', getAllPoor);
			
			async function getAllPoor(e){
				e.preventDefault();
				const res = await fetch(baseUrl8,
				{
					method: 'GET'
				})
				const data8 = await res.json();
				console.log(data8);
				allpoorResult.innerHTML = "";
				
				data8.forEach(e => {
					const row8 = document.createElement("tr");
					row8.innerHTML = `<td>${e.username}</td>`
					allpoorResult.appendChild(row8);
				})
			}
		
		/*Phase 2 search*/
		const searchForm = document.getElementById("search-form");
		const resultsTable = document.getElementById("results-table");
		const resultsBody = document.getElementById("results-body");

		searchForm.addEventListener("submit", async (e) => {
			e.preventDefault();
			const category = document.getElementById("input").value;

			// Send a POST request to the server to fetch results for the given category
			const response = await fetch("/searchcategory", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({ category }),
			});

			if (response.ok) {
				const data = await response.json();
				resultsBody.innerHTML = ""; // Clear previous results

				data.forEach(item => {
					const row = document.createElement("tr");
					row.innerHTML = `<td>${item.title}</td><td>${item.category}</td>`;
					resultsBody.appendChild(row);
				});
			}
		});
		</script>
	
	</body>
</html>
