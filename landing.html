<!DOCTYPE html>
<html lang="en">
	<head>
        <style>
            body{
				background: #f2f2f2;
				font-family: Consolas, monaco, monospace;
			}

            h1{
				text-align: center;
				color: black;
				font-size: 45px;
				margin-bottom: 15px;
			}

			h2{
				text-align: left;
				margin-bottom: 15px;
			}

            div.form {
				text-align: center;
				font-size: 20px;
			}
            
            form [type = text] {
				width: 15%;
				border: 2px solid black;
				border-radius:4px;
				padding: 5px 5px;
				margin: 5px;
				box-sizing: border-box;
				font-family: inherit;
            }

            button{
				background-color: lightblue;
				border: none;
				color: black;
				border-radius: 4px;
				padding: 8px 16px;
				text-decoration: none;
				margin: 4px 2px;
				cursor: pointer;
				transition-duration:0.2s;
				font-family: inherit;
                font-weight: bold;
			}

			button:hover {
                background-color: black;
				color: lightblue;
            }

			table, th, td{
				width: 30%;
				border: 1.5px solid black;
				border-collapse: collapse;
				margin-bottom: 15px;
			}
			th{
				background-color: lightblue;
			}
        </style>
		<title>Welcome</title>
	</head>
	<body>
		<h1>Welcome</h1>
		<div class="form">
			<br>Add an item<br>
			<form action="/additem" method="POST">			
				<label for="inputTitle">Title</label>
				<input type="text" name="intitle">
				<br>
				
				<label for="inputDesc">Description: </label>
				<input type="text" name="indescription">
				<br>
				
				<label for="inputCategory">Category: </label>
				<input type="text" name="incategory">
				<br>
				
				<label for="inputPrice">Price: </label>
				<input type="text" name="inprice">
				<button type="submit">Add Item</button>
			</form>
		</div>	

		<hr>riley<hr>
		<div class="form">	
			<form id="search-form" action="/searchcategory" method="POST">
				<label for="category">Enter a category: </label>
				<input type="text" id="input" name="category" placeholder="Category">
				<button type="submit">Search</button>
			</form>
		<h2>Results:</h2>
		<table id="results-table">
			<thead>
				<tr>
					<th>Items</th>
					<th>Category</th>
				</tr>
			</thead>
			<tbody id="results-body">

			</tbody>
		</table>
		</div>
		<script>
			const searchForm = document.getElementById("search-form");
			const resultsTable = document.getElementById("results-table");
			const resultsBody = document.getElementById("results-body");
		
			searchForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				const category = document.getElementById("input").value;
		
				// Send a POST request to the server to fetch results for the given category
				const response = await fetch("/searchcategory", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({ category }),
				});
		
				if (response.ok) {
					const data = await response.json();
					resultsBody.innerHTML = ""; // Clear previous results
		
					data.forEach(item => {
						const row = document.createElement("tr");
						row.innerHTML = `<td>${item.title}</td><td>${item.category}</td>`;
						resultsBody.appendChild(row);
					});
				}
			});
		</script>

		<hr>java<hr>
		<div id="add-review">
			<h2>Add a Review:</h2>
				<form id="review-form">
					<label for="itemSelect">Select an item:</label>
					<select id="itemSelect" name="itemSelect">
						<option value="Test Item">Test Item</option>
						<option value="Test Item 2">Test Item 2</option>
						<option value="Test Item 3">Test Item 3</option>
						<option value="Test Item 4">Test Item 4</option>
						<!-- We can add more items here -->
					</select>
					<br>
					<label for="ratingSelect">Select a rating:</label>
					<select id="ratingSelect" name="ratingSelect">
						<option value="excellent">Excellent</option>
						<option value="good">Good</option>
						<option value="fair">Fair</option>
						<option value="poor">Poor</option>
					</select>
						<br>
					<label for="reviewText">Review:</label>
					<textarea id="reviewText" name="reviewText" rows="4" cols="50"></textarea>
					<br>
					<button type="button" id="submitReview">Submit Review</button>
			</form>
		</div>
		<hr>
		<h2>Create table button</h2>
			<form action="/createtable" method="post">
				<button type="submit" class="mybutton">Create table</button>
		<hr>
		<a href="\">Logout</a>
		<script>
			
		</script>

<!--Script to handle review calls when submit button is pressed-->
			<script>
			document.getElementById('submitReview').addEventListener('click', function () {
			const item = document.getElementById('itemSelect').value;
			const rating = document.getElementById('ratingSelect').value;
			const reviewText = document.getElementById('reviewText').value;

			const data = { item, rating, reviewText };

			fetch('/submitreview', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			})
			.then(response => {
				if (response.ok) {
					console.log('Review submitted successfully');
					alert('Review submitted successfully');
					document.getElementById('reviewText').value = ''; // Clear the review text area
				} else if (response.status === 403) {
					console.log('You have already submitted three reviews today.');
					alert('You have already submitted three reviews today.');
				} else {
					response.text().then(errorMessage => {
						console.log('Error:', errorMessage);
						alert('You have already submitted a review for this item: ');
					});
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('An error occurred. Please try again.');
			});
		});
				</Script>
	
	</body>
</html>
